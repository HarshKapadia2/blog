<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Transport Layer Security | Harsh Kapadia's Blog</title><meta name=keywords content="tls,ssl,computer networking"><meta name=description content="Working of TLS."><meta name=author content="Harsh Kapadia"><link rel=canonical href=https://blog.harshkapadia.me/2021/tls/><link crossorigin=anonymous href=/assets/css/stylesheet.a090830a421002426baafbd314e38f149d77b4c48a12ee9312700d770b27fb26.css integrity="sha256-oJCDCkIQAkJrqvvTFOOPFJ13tMSKEu6TEnANdwsn+yY=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.harshkapadia.me/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.harshkapadia.me/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.harshkapadia.me/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.harshkapadia.me/apple-touch-icon.png><link rel=mask-icon href=https://blog.harshkapadia.me/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.harshkapadia.me/2021/tls/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://blog.harshkapadia.me/2021/tls/"><meta property="og:site_name" content="Harsh Kapadia's Blog"><meta property="og:title" content="Transport Layer Security"><meta property="og:description" content="Working of TLS."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-01-20T15:23:30+05:30"><meta property="article:modified_time" content="2021-01-20T15:23:30+05:30"><meta property="article:tag" content="Tls"><meta property="article:tag" content="Ssl"><meta property="article:tag" content="Computer Networking"><meta property="og:image" content="https://blog.harshkapadia.me/2021/tls/cover.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.harshkapadia.me/2021/tls/cover.png"><meta name=twitter:title content="Transport Layer Security"><meta name=twitter:description content="Working of TLS."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.harshkapadia.me/posts/"},{"@type":"ListItem","position":2,"name":"Transport Layer Security","item":"https://blog.harshkapadia.me/2021/tls/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Transport Layer Security","name":"Transport Layer Security","description":"Working of TLS.","keywords":["tls","ssl","computer networking"],"articleBody":"What is TLS? The Transport Layer Security (TLS) protocol helps in encrypting and authenticating the communication between two services. It is a Transport Layer protocol as per the OSI Model. It is the better version of the Secure Sockets Layer (SSL) protocol. (The last SSL version was 3.0.) TLS 1.0 was also called SSL 3.1. The latest version of TLS is 1.3. It is placed between TCP and HTTP. Usually TCP -\u003e HTTP, but with HTTPS, TCP -\u003e TLS -\u003e HTTP. Thus, HTTPS is also called ‚ÄòHTTP over TLS (or SSL)‚Äô. It is not just used in web sites. It is used for other communication as well, for eg, DB communication, browsing on TOR browser, etc. Examples NOTE:\nThis information can be found in the Security tab in the browser DevTools or on clicking the ‚Äôlock‚Äô (or ‚Äòunlock‚Äô) symbol to the left of the URL in the browser search bar. The string of cipher information seen in the pictures below is called a ‚Äòcipher suite‚Äô. There are several of them for each protocol and they tell us which ciphers are being used by a particular protocol after both machines have agreed on the ciphers to be used. https://github.com üëá\nhttps://otc.zulipchat.com üëá\nSource üëá\nNOTE: Resources for everything written below can be found in the ‚ÄòResources‚Äô section at the end of this file.\nCryptography in TLS Some common terms seen in the pictures above\nDiffie-Hellman (EDCHE, X25519, P-256, etc) RSA AES SHA256 Diffie-Hellman (DH) It is a part of Public/Asymmetric Key Cryptography. It is a Key Exchange Protocol for a shared secret between two devices who want to start communication. The established shared secret is then used to derive symmetric keys with Private/Symmetric/Secret Key Cryptography ciphers like AES (because Private Key Cryptography is faster than Public Key Cryptography). Some types of DH ECDHE (Elliptic Curve Diffie-Hellman Ephemeral) Ephemeral means ‚Äòsomething that lasts for a short time‚Äô and here it implies that a new key is generated every time a conversation takes place, ie, very frequently. X25519 A type of Elliptic Curve Diffie-Hellman that uses Curve25519. P-256 A type of curve used in Elliptic Curve Cryptography. Vulnerable to ‚ÄòMan in the Middle‚Äô attacks and here is were Public Key Cryptography ciphers like RSA, DSA, etc help out by providing authentication. Perfect Forward Secrecy (PFS) Just RSA can be used in place of Diffie-Hellman, but is not, as it is slow and its keys are established for over years, which if leaked, pose a big risk. So, Diffie-Hellman (DH) is used as a quicker method and safety blanket for key exchange, with RSA only providing initial authenticity. It acts as a safety blanket, as it generates keys independently of RSA and after every session (if the ephemeral version of DH is used) and the communication will not be compromised even if the RSA private key is leaked. RSA Type of Public/Asymmetric Key Cryptography cipher. The name ‚ÄòRSA‚Äô is an acronym of the scientists involved in making the cipher. The scientists in order: Ron Rivest, Adi Shamir and Leonard Adleman. Ensures authenticity of sender. Prevents ‚ÄòMan in the Middle‚Äô attacks, as it authenticates the sender. AES Advanced Encryption Standard (AES) is a type of a Private/Symmetric/Secret Key Cryptography cipher. The shared secret from Diffie-Hellman is used to derive a key. Provides encryption for the data being shared between the two communicating machines. SHA256 Hashing algorithm which is a part of the Secure Hashing Algorithm (SHA) family. (SHA2 to be specific.) Generates a unique* 256 bit hexadecimal string output called a ‚Äòhash‚Äô, for any length of input. unique*: Hash collisions are extremely rare. Used wherever needed, for eg, to derive a key from the shared secret, in digital signatures, etc. Conditions to be fulfilled by a TLS handshake What ciphers to be used for normal communication. Eg: AES Key exchange cipher to generate a symmetric key. Eg: Diffie-Hellman Authentication Public/Asymmetric Key Cryptography like RSA and verifying with digital signature with certificates. Robustness Prevent Man in the Middle Attacks, Replay Attacks, Downgrade Attacks, etc during the handshake. TLS 1.2 handshake NOTE:\nC = Client and S = Server. TLS 1.2 takes two roundtrips (C -\u003e S, S -\u003e C, C -\u003e S and S -\u003e C) to complete the handshake. (TLS 1.3 takes just one roundtrip.) The TLS 1.2 handshake as seen in Wireshark üëá TLS works on top of TCP, so a TCP handshake is done first.\nC -\u003e S Client Hello\nStates max version of TLS supported. Send a random number to prevent Replay attacks. Sends a list of cipher suites that the client supports. Client Hello üëá Contents of ‚ÄòRandom‚Äô üëá S -\u003e C Server Hello\nChoose TLS version and cipher suite. Send random number. Send a certificate (with the public key of the server attached to it.) Server Key Exchange message (DH) It sends params for the Diffie-Hellman (DH) key exchange. (The generator and the huge prime number.) It sends it‚Äôs generated public part of the key exchange process. Digital signature (a hashed value of some of the previous messages signed by the private key of the server). RSA is used here. Send ‚ÄòServer Hello Done‚Äô. Server Hello üëá Server Key Exchange üëá Server Key Exchange (contd) üëá Server Hello Done ‚òùÔ∏è\nC -\u003e S Client Key Exchange message (DH)\nIt sends it‚Äôs generated public part of the key exchange process. Side note: Both the server and client can now form the pre-master secret by completing the Diffie-Hellman process and then combine them with the random numbers sent in the above messages to make the master secret. Change Cipher Spec message. (Says that it is ready to begin encryption.) Finished message (Contains an encrypted summary of all the messages so far.) Client Key Exchange üëá Change Cipher Spec üëá Finished üëá S -\u003e C Change Cipher Spec message\nFinished message (Contains an encrypted summary of all the messages so far.) Side note: Only if the two finished messages match, will the handshake succeed. This prevents any Man in the Middle attacks. Change Cipher Spec üëá Finished üëá The handshake is complete. The application data is encrypted using the Private/Symmetric/Secret Key Cryptography cipher mentioned in the chosen cipher suite (Eg: AES) and both machines can now communicate with encryption and authenticity.\nAn overview of the TLS 1.2 handshake üëá TLS 1.3 handshake NOTE:\nC = Client and S = Server. TLS 1.3 takes one roundtrip (C -\u003e S and S -\u003e C) to complete the handshake. (TLS 1.2 takes two roundtrips.) TLS works on top of TCP, so a TCP handshake is done first.\nC -\u003e S Client Hello\nSend list of supported TLS versions. Send random number. Send list of supported Cipher Suites. Send Client Key Exchange. Send TLS Extensions SNI or ESNI ALPN Client Hello üëá S -\u003e C Server Hello\nAgree on a cipher suite. Agree on TLS protocol version. Send random number. Send Server Key Exchange. Send Certificate. Send TLS Extensions. OCSP Stapling (Certificate Verify) Send Finished message. Server Hello üëá C -\u003e S Client sends a Finished message and then encrypted and authenticated communication starts.\nAn overview of the TLS 1.3 handshake (as a cURL request) üëá Resources TLS TLS Intro TLS Handshake Illustrated TLS 1.2 Handshake Illustrated TLS 1.3 Handshake Wiresharking TLS cURL Verbose Mode Explained TLS playlist by Hussein Nasser Application Layer Protocol Negotiation (ALPN) Server Name Indication (SNI and ESNI) Cryptography (for Diffie-Hellman, RSA, AES, Hashing, Digital signatures and Digital certificates resources) Perfect Forward Secrecy (PFS) in TLS Heartbleed problem Automatic Cipher Suite Ordering in crypto/tls (The Go Blog) Picture sources RFC 5246: The Transport Layer Security (TLS) Protocol Version 1.2 Dissecting TLS Using Wireshark SSL/TLS Handshake Explained With Wireshark Screenshot ","wordCount":"1276","inLanguage":"en","image":"https://blog.harshkapadia.me/2021/tls/cover.png","datePublished":"2021-01-20T15:23:30+05:30","dateModified":"2021-01-20T15:23:30+05:30","author":[{"@type":"Person","name":"Harsh Kapadia"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.harshkapadia.me/2021/tls/"},"publisher":{"@type":"Organization","name":"Harsh Kapadia's Blog","logo":{"@type":"ImageObject","url":"https://blog.harshkapadia.me/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.harshkapadia.me/ accesskey=h title="Harsh Kapadia's Blog (Alt + H)">Harsh Kapadia's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.harshkapadia.me/tags title=Tags><span>Tags</span></a></li><li><a href=https://harshkapadia.me title=harshkapadia.me><span>harshkapadia.me</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.harshkapadia.me/>Home</a>&nbsp;¬ª&nbsp;<a href=https://blog.harshkapadia.me/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Transport Layer Security</h1><div class=post-description>Working of TLS.</div><div class=post-meta><span title='2021-01-20 15:23:30 +0530 +0530'>January 20, 2021</span>&nbsp;¬∑&nbsp;<span>6 min</span>&nbsp;¬∑&nbsp;<span>Harsh Kapadia</span>&nbsp;|&nbsp;<span>
<a href=https://github.com/HarshKapadia2/blog/tree/main/content/posts/tls.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></span></div></header><figure class=entry-cover><img loading=eager src=https://blog.harshkapadia.me/2021/tls/cover.png alt="HTTP vs HTTPS"><figcaption>HTTP vs HTTPS (HTTP over TLS)</figcaption></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#what-is-tls aria-label="What is TLS?">What is TLS?</a></li><li><a href=#examples aria-label=Examples>Examples</a></li><li><a href=#cryptography-in-tls aria-label="Cryptography in TLS">Cryptography in TLS</a><ul><li><a href=#diffie-hellman-dh aria-label="Diffie-Hellman (DH)">Diffie-Hellman (DH)</a></li><li><a href=#rsa aria-label=RSA>RSA</a></li><li><a href=#aes aria-label=AES>AES</a></li><li><a href=#sha256 aria-label=SHA256>SHA256</a></li></ul></li><li><a href=#conditions-to-be-fulfilled-by-a-tls-handshake aria-label="Conditions to be fulfilled by a TLS handshake">Conditions to be fulfilled by a TLS handshake</a></li><li><a href=#tls-12-handshake aria-label="TLS 1.2 handshake">TLS 1.2 handshake</a></li><li><a href=#tls-13-handshake aria-label="TLS 1.3 handshake">TLS 1.3 handshake</a></li><li><a href=#resources aria-label=Resources>Resources</a></li></ul></div></details></div><div class=post-content><h2 id=what-is-tls>What is TLS?<a hidden class=anchor aria-hidden=true href=#what-is-tls>#</a></h2><ul><li>The Transport Layer Security (TLS) protocol helps in encrypting and authenticating the communication between two services.</li><li>It is a Transport Layer protocol as per the <a href=https://harshkapadia2.github.io/networking/osi_layers.html>OSI Model</a>.</li><li>It is the better version of the Secure Sockets Layer (SSL) protocol. (The last SSL version was 3.0.)<ul><li>TLS 1.0 was also called SSL 3.1.</li></ul></li><li>The latest version of TLS is 1.3.</li><li>It is placed between TCP and <a href=https://harshkapadia2.github.io/networking/http.html>HTTP</a>.<ul><li>Usually TCP -> HTTP, but with HTTPS, TCP -> TLS -> HTTP.</li><li>Thus, HTTPS is also called &lsquo;HTTP over TLS (or SSL)&rsquo;.</li></ul></li><li>It is not just used in web sites. It is used for other communication as well, for eg, DB communication, browsing on TOR browser, etc.</li></ul><h2 id=examples>Examples<a hidden class=anchor aria-hidden=true href=#examples>#</a></h2><blockquote><p>NOTE:</p><ul><li>This information can be found in the Security tab in the browser DevTools or on clicking the &rsquo;lock&rsquo; (or &lsquo;unlock&rsquo;) symbol to the left of the URL in the browser search bar.</li><li>The string of cipher information seen in the pictures below is called a &lsquo;cipher suite&rsquo;. There are several of them for each protocol and they tell us which ciphers are being used by a particular protocol after both machines have agreed on the ciphers to be used.</li></ul></blockquote><p><em><a href=https://github.com>https://github.com</a></em> &#x1f447;</p><p><img loading=lazy src=github.png></p><p><em><a href=https://otc.zulipchat.com>https://otc.zulipchat.com</a></em> &#x1f447;</p><p><img loading=lazy src=zulip.png></p><p><a href="https://youtu.be/86cQJ0MMses?t=65"><em>Source</em></a> &#x1f447;</p><p><img loading=lazy src=yt_vid.png></p><blockquote><p><strong>NOTE: Resources for everything written below can be found in the &lsquo;<a href=#resources>Resources</a>&rsquo; section at the end of this file.</strong></p></blockquote><h2 id=cryptography-in-tls>Cryptography in TLS<a hidden class=anchor aria-hidden=true href=#cryptography-in-tls>#</a></h2><p>Some common terms seen in the pictures above</p><ul><li>Diffie-Hellman (EDCHE, X25519, P-256, etc)</li><li>RSA</li><li>AES</li><li>SHA256</li></ul><h3 id=diffie-hellman-dh>Diffie-Hellman (DH)<a hidden class=anchor aria-hidden=true href=#diffie-hellman-dh>#</a></h3><ul><li>It is a part of Public/Asymmetric Key Cryptography.</li><li>It is a Key Exchange Protocol for a shared secret between two devices who want to start communication.</li><li>The established shared secret is then used to derive symmetric keys with Private/Symmetric/Secret Key Cryptography ciphers like AES (because Private Key Cryptography is faster than Public Key Cryptography).</li><li>Some types of DH<ul><li>ECDHE (Elliptic Curve Diffie-Hellman Ephemeral)<ul><li>Ephemeral means &lsquo;something that lasts for a short time&rsquo; and here it implies that a new key is generated every time a conversation takes place, ie, very frequently.</li></ul></li><li>X25519<ul><li>A type of Elliptic Curve Diffie-Hellman that uses Curve25519.</li></ul></li><li>P-256<ul><li>A type of curve used in Elliptic Curve Cryptography.</li></ul></li></ul></li><li>Vulnerable to &lsquo;Man in the Middle&rsquo; attacks and here is were Public Key Cryptography ciphers like RSA, DSA, etc help out by providing authentication.<ul><li>Perfect Forward Secrecy (PFS)<ul><li>Just RSA can be used in place of Diffie-Hellman, but is not, as it is slow and its keys are established for over years, which if leaked, pose a big risk.</li><li>So, Diffie-Hellman (DH) is used as a quicker method and safety blanket for key exchange, with RSA only providing initial authenticity. It acts as a safety blanket, as it generates keys independently of RSA and after every session (if the ephemeral version of DH is used) and the communication will not be compromised even if the RSA private key is leaked.</li></ul></li></ul></li></ul><h3 id=rsa>RSA<a hidden class=anchor aria-hidden=true href=#rsa>#</a></h3><ul><li>Type of Public/Asymmetric Key Cryptography cipher.</li><li>The name &lsquo;RSA&rsquo; is an acronym of the scientists involved in making the cipher.<ul><li>The scientists in order: Ron Rivest, Adi Shamir and Leonard Adleman.</li></ul></li><li>Ensures authenticity of sender.</li><li>Prevents &lsquo;Man in the Middle&rsquo; attacks, as it authenticates the sender.</li></ul><h3 id=aes>AES<a hidden class=anchor aria-hidden=true href=#aes>#</a></h3><ul><li>Advanced Encryption Standard (AES) is a type of a Private/Symmetric/Secret Key Cryptography cipher.</li><li>The shared secret from Diffie-Hellman is used to derive a key.</li><li>Provides encryption for the data being shared between the two communicating machines.</li></ul><h3 id=sha256>SHA256<a hidden class=anchor aria-hidden=true href=#sha256>#</a></h3><ul><li>Hashing algorithm which is a part of the Secure Hashing Algorithm (SHA) family. (SHA2 to be specific.)</li><li>Generates a unique* 256 bit hexadecimal string output called a &lsquo;hash&rsquo;, for any length of input.<ul><li>unique*: Hash collisions are extremely rare.</li></ul></li><li>Used wherever needed, for eg, to derive a key from the shared secret, in digital signatures, etc.</li></ul><h2 id=conditions-to-be-fulfilled-by-a-tls-handshake>Conditions to be fulfilled by a TLS handshake<a hidden class=anchor aria-hidden=true href=#conditions-to-be-fulfilled-by-a-tls-handshake>#</a></h2><ul><li>What ciphers to be used for normal communication.<ul><li>Eg: AES</li></ul></li><li>Key exchange cipher to generate a symmetric key.<ul><li>Eg: Diffie-Hellman</li></ul></li><li>Authentication<ul><li>Public/Asymmetric Key Cryptography like RSA and verifying with digital signature with certificates.</li></ul></li><li>Robustness<ul><li>Prevent Man in the Middle Attacks, Replay Attacks, Downgrade Attacks, etc during the handshake.</li></ul></li></ul><h2 id=tls-12-handshake>TLS 1.2 handshake<a hidden class=anchor aria-hidden=true href=#tls-12-handshake>#</a></h2><blockquote><p>NOTE:</p><ul><li><code>C</code> = Client and <code>S</code> = Server.</li><li>TLS 1.2 takes two roundtrips (<code>C -> S</code>, <code>S -> C</code>, <code>C -> S</code> and <code>S -> C</code>) to complete the handshake. (TLS 1.3 takes just one roundtrip.)</li></ul></blockquote><p>The TLS 1.2 handshake as seen in Wireshark &#x1f447;
<img loading=lazy src=tls_1.2_wireshark.png#center></p><ul><li><p>TLS works on top of TCP, so a <a href="https://www.youtube.com/watch?v=bW_BILl7n0Y">TCP handshake</a> is done first.</p></li><li><p><code>C -> S</code> Client Hello</p><ul><li>States max version of TLS supported.</li><li>Send a random number to prevent Replay attacks.</li><li>Sends a list of cipher suites that the client supports.</li></ul><p>Client Hello &#x1f447;
<img loading=lazy src=tls_1.2_client_hello.png#center></p><p>Contents of &lsquo;Random&rsquo; &#x1f447;
<img loading=lazy src=tls_1.2_random.png#center></p></li><li><p><code>S -> C</code> Server Hello</p><ul><li>Choose TLS version and cipher suite.</li><li>Send random number.</li><li>Send a certificate (with the public key of the server attached to it.)</li><li>Server Key Exchange message (DH)<ul><li>It sends params for the Diffie-Hellman (DH) key exchange. (The generator and the huge prime number.)</li><li>It sends it&rsquo;s generated public part of the key exchange process.</li><li>Digital signature (a hashed value of some of the previous messages signed by the private key of the server). RSA is used here.</li><li>Send &lsquo;Server Hello Done&rsquo;.</li></ul></li></ul><p>Server Hello &#x1f447;
<img loading=lazy src=tls_1.2_server_hello.png#center></p><p>Server Key Exchange &#x1f447;
<img loading=lazy src=tls_1.2_server_key_exchange_1.png#center></p><p>Server Key Exchange (contd) &#x1f447;
<img loading=lazy src=tls_1.2_server_key_exchange_2.png#center>
Server Hello Done &#9757;&#xfe0f;</p></li><li><p><code>C -> S</code> Client Key Exchange message (DH)</p><ul><li>It sends it&rsquo;s generated public part of the key exchange process.</li><li>Side note: Both the server and client can now form the pre-master secret by completing the Diffie-Hellman process and then combine them with the random numbers sent in the above messages to make the master secret.</li><li>Change Cipher Spec message. (Says that it is ready to begin encryption.)</li><li>Finished message (Contains an encrypted summary of all the messages so far.)</li></ul><p>Client Key Exchange &#x1f447;
<img loading=lazy src=tls_1.2_client_key_exchange.png#center></p><p>Change Cipher Spec &#x1f447;
<img loading=lazy src=tls_1.2_change_cipher_spec_1.png#center></p><p>Finished &#x1f447;
<img loading=lazy src=tls_1.2_finished_1.png#center></p></li><li><p><code>S -> C</code> Change Cipher Spec message</p><ul><li>Finished message (Contains an encrypted summary of all the messages so far.)</li><li>Side note: Only if the two finished messages match, will the handshake succeed. This prevents any Man in the Middle attacks.</li></ul><p>Change Cipher Spec &#x1f447;
<img loading=lazy src=tls_1.2_change_cipher_spec_2.png#center></p><p>Finished &#x1f447;
<img loading=lazy src=tls_1.2_finished_2.png#center></p></li><li><p>The handshake is complete. The application data is encrypted using the Private/Symmetric/Secret Key Cryptography cipher mentioned in the <strong>chosen</strong> cipher suite (Eg: AES) and both machines can now communicate with encryption and authenticity.</p><p>An overview of the TLS 1.2 handshake &#x1f447;
<img loading=lazy src=tls_1.2_overview.png#center></p></li></ul><h2 id=tls-13-handshake>TLS 1.3 handshake<a hidden class=anchor aria-hidden=true href=#tls-13-handshake>#</a></h2><blockquote><p>NOTE:</p><ul><li><code>C</code> = Client and <code>S</code> = Server.</li><li>TLS 1.3 takes one roundtrip (<code>C -> S</code> and <code>S -> C</code>) to complete the handshake. (TLS 1.2 takes two roundtrips.)</li></ul></blockquote><ul><li><p>TLS works on top of TCP, so a <a href="https://www.youtube.com/watch?v=bW_BILl7n0Y">TCP handshake</a> is done first.</p></li><li><p><code>C -> S</code> Client Hello</p><ul><li>Send list of supported TLS versions.</li><li>Send random number.</li><li>Send list of supported Cipher Suites.</li><li>Send Client Key Exchange.</li><li>Send TLS Extensions<ul><li><a href="https://www.youtube.com/watch?v=t0zlO5-NWFU">SNI or ESNI</a></li><li><a href="https://www.youtube.com/watch?v=lR1uHVS7I-8">ALPN</a></li></ul></li></ul><p>Client Hello &#x1f447;
<img loading=lazy src=tls_1.3_client_hello.png#center></p></li><li><p><code>S -> C</code> Server Hello</p><ul><li>Agree on a cipher suite.</li><li>Agree on TLS protocol version.</li><li>Send random number.</li><li>Send Server Key Exchange.</li><li>Send Certificate.</li><li>Send TLS Extensions.<ul><li>OCSP Stapling (Certificate Verify)</li></ul></li><li>Send Finished message.</li></ul><p>Server Hello &#x1f447;
<img loading=lazy src=tls_1.3_server_hello.png#center></p></li><li><p><code>C -> S</code> Client sends a Finished message and then encrypted and authenticated communication starts.</p><p>An overview of the TLS 1.3 handshake (as a cURL request) &#x1f447;
<img loading=lazy src=tls_1.3_overview_1.png#center>
<img loading=lazy src=tls_1.3_overview_2.png#center>
<img loading=lazy src=tls_1.3_overview_3.png#center></p></li></ul><h2 id=resources>Resources<a hidden class=anchor aria-hidden=true href=#resources>#</a></h2><ul><li>TLS<ul><li><a href="https://www.youtube.com/watch?v=0TLDTodL7Lc">TLS Intro</a></li><li><a href="https://www.youtube.com/watch?v=86cQJ0MMses">TLS Handshake</a></li><li><a href=https://tls.ulfheim.net/>Illustrated TLS 1.2 Handshake</a></li><li><a href=https://tls13.ulfheim.net/>Illustrated TLS 1.3 Handshake</a></li><li><a href="https://www.youtube.com/watch?v=06Kq50P01sI">Wiresharking TLS</a></li><li><a href="https://www.youtube.com/watch?v=PVm0YEEuS8s">cURL Verbose Mode Explained</a></li><li><a href="https://www.youtube.com/playlist?list=PLQnljOFTspQW4yHuqp_Opv853-G_wAiH-">TLS playlist by Hussein Nasser</a></li></ul></li><li><a href="https://www.youtube.com/watch?v=lR1uHVS7I-8">Application Layer Protocol Negotiation (ALPN)</a></li><li><a href="https://www.youtube.com/watch?v=t0zlO5-NWFU">Server Name Indication (SNI and ESNI)</a></li><li><a href=https://harshkapadia2.github.io/networking/cryptography.html>Cryptography</a> (for Diffie-Hellman, RSA, AES, Hashing, Digital signatures and Digital certificates resources)</li><li><a href="https://www.youtube.com/watch?v=zSQtyW_ywZc">Perfect Forward Secrecy (PFS) in TLS</a><ul><li><a href="https://www.youtube.com/watch?v=1dOCHwf8zVQ">Heartbleed problem</a></li></ul></li><li><a href=https://go.dev/blog/tls-cipher-suites>Automatic Cipher Suite Ordering in <code>crypto/tls</code></a> (The Go Blog)</li><li>Picture sources<ul><li><a href=https://tools.ietf.org/html/rfc5246>RFC 5246: The Transport Layer Security (TLS) Protocol Version 1.2</a></li><li><a href=https://blog.catchpoint.com/2017/05/12/dissecting-tls-using-wireshark/>Dissecting TLS Using Wireshark</a></li><li><a href=https://www.linuxbabe.com/security/ssltls-handshake-process-explained-with-wireshark-screenshot>SSL/TLS Handshake Explained With Wireshark Screenshot</a></li></ul></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.harshkapadia.me/tags/tls/>Tls</a></li><li><a href=https://blog.harshkapadia.me/tags/ssl/>Ssl</a></li><li><a href=https://blog.harshkapadia.me/tags/computer-networking/>Computer Networking</a></li></ul><nav class=paginav><a class=prev href=https://blog.harshkapadia.me/2021/dns-records/><span class=title>¬´ Prev</span><br><span>DNS Records</span>
</a><a class=next href=https://blog.harshkapadia.me/2020/ipsec/><span class=title>Next ¬ª</span><br><span>IPSec</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Transport Layer Security on x" href="https://x.com/intent/tweet/?text=Transport%20Layer%20Security&amp;url=https%3a%2f%2fblog.harshkapadia.me%2f2021%2ftls%2f&amp;hashtags=tls%2cssl%2ccomputernetworking"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Transport Layer Security on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fblog.harshkapadia.me%2f2021%2ftls%2f&amp;title=Transport%20Layer%20Security&amp;summary=Transport%20Layer%20Security&amp;source=https%3a%2f%2fblog.harshkapadia.me%2f2021%2ftls%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Transport Layer Security on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.harshkapadia.me%2f2021%2ftls%2f&title=Transport%20Layer%20Security"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Transport Layer Security on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.harshkapadia.me%2f2021%2ftls%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Transport Layer Security on whatsapp" href="https://api.whatsapp.com/send?text=Transport%20Layer%20Security%20-%20https%3a%2f%2fblog.harshkapadia.me%2f2021%2ftls%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Transport Layer Security on telegram" href="https://telegram.me/share/url?text=Transport%20Layer%20Security&amp;url=https%3a%2f%2fblog.harshkapadia.me%2f2021%2ftls%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Transport Layer Security on ycombinator" href="https://news.ycombinator.com/submitlink?t=Transport%20Layer%20Security&u=https%3a%2f%2fblog.harshkapadia.me%2f2021%2ftls%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>¬© 2025 <a href=https://harshkapadia.me>Harsh Kapadia</a> |</span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>